<!--

    Copyright 2014 Jai Veeraswami.
    All rights reserved.

    Ranchero 1.0.0.001
    Release Notes
    - Initial Development
    Known Bugs
    - 
    To Do List
    - Consider removing 'save changes'
      button in favor of auto-save
      functionality
    Bug Fixes
    - None
    Improvements
    - None
    
-->

<!DOCTYPE html>
<html>
<head>
    
    <!-- Document Title -->
    <title> Mule Tracker - Release 1.0.0.001 </title>

    <!-- StyleSheet Import -->
    <link rel="stylesheet" href="styles.css"/>
    <link rel="stylesheet" href="blocks.css"/>

    <!-- JavaScript Import -->
    <script type="text/javascript" src="engine.js"></script>

</head>
<body>
    
    <sector name="PROJECTRANCHERO">
        <div id="interface" class="noselect">
            <div id="left-panel">
                <div id="left-title-group">
                    <div id="left-heavy-title">Mule Tracker</div>
                    <div id="left-light-title">by Redwindon</div>
                </div>
                <div id="mule-list"></div>
                <div id="create-mule-button">new mule</div>
                <div id="attribution">Designed by Jai in California</div>
            </div>
            <div id="right-panel">
                <div id="right-title-group">
                    <span id="right-heavy-title"></span>
                    <span id="right-light-title"></span>
                </div>
                <div id="left-di-list">
                    <div id="di-list-item">
                        <div id="di-list-item-label">Email:</div>
                        <input id="di-list-item-input-email" value="N/A">
                        <div id="di-list-item-action-button" class="email">copy</div>
                    </div>
                    <div id="di-list-item">
                        <div id="di-list-item-label">Password:</div>
                        <input id="di-list-item-input-password" value="N/A">
                        <div id="di-list-item-action-button" class="password">copy</div>
                    </div>
                </div>
                <div id="right-di-list">
                    <div id="di-list-item">
                        <div id="di-list-item-label">Total Slots:</div>
                        <input id="di-list-item-input-total" value="N/A">
                    </div>
                    <div id="di-list-item">
                        <div id="di-list-item-label">Slots Used:</div>
                        <output id="di-list-item-output-used">N/A</output>
                    </div>
                </div>
                
                <div id="right-interface-window-storage">
                    <div id="block-container">
                        <div class="slot occupied">
                            
                            <div class="block bows_UT_DOOMBOW">
        
                                <div class="pixel x6y0"></div>
                                <div class="pixel x7y0"></div>

                                <div class="pixel x5y1"></div>
                                <div class="pixel x7y1"></div>

                                <div class="pixel x4y2"></div>
                                <div class="pixel x7y2"></div>

                                <div class="pixel x3y3"></div>
                                <div class="pixel x6y3"></div>
                                <div class="pixel x7y3"></div>

                                <div class="pixel x2y4"></div>
                                <div class="pixel x4y4"></div>
                                <div class="pixel x5y4"></div>

                                <div class="pixel x1y5"></div>
                                <div class="pixel x4y5"></div>
                                <div class="pixel x5y5"></div>

                                <div class="pixel x0y6"></div>
                                <div class="pixel x3y6"></div>

                                <div class="pixel x0y7"></div>
                                <div class="pixel x1y7"></div>
                                <div class="pixel x2y7"></div>
                                <div class="pixel x3y7"></div>
                                
                            </div>
                            
                        </div>
                        <div class="slot"></div>
                        <div class="slot"></div>
                        <div class="slot"></div>
                        <div class="slot"></div>
                        <div class="slot"></div>
                        <div class="slot"></div>
                        <div class="slot"></div>
                        <div class="slot"></div>
                        <div class="slot"></div>
                        <div class="slot"></div>
                        <div class="slot"></div>
                        <div class="slot"></div>
                        <div class="slot"></div>
                        <div class="slot"></div>
                        <div class="slot"></div>
                    </div>
                </div>
                
                <div id ="rename-mule-button">rename mule</div>
                <div id ="delete-mule-button">delete mule</div>
                
            </div>
        </div> <!-- mules window interface -->
        <div id="block-interface">
        
        </div> <!-- block module interface -->
    </sector> <!-- DOM construction -->
    <script type="text/javascript">
        
        /* Mutable Global Variables */
        var MULES = new ObjectLibrary('MULES');
        
        /* Immutable Global Variables */
        
    </script> <!-- global variables -->
    <script type="text/javascript">
        
        /* Immutable Global Functions */
        function DOMInjectMuleList() {
            
            // Empty the container
            (function () {
                document.getElementById('mule-list').innerHTML = '';
            }());
            
            // Append the mules
            (function () {
                MULES.sortBy('name');
                MULES.save();
                if (MULES.list.length < 1) {
                    document.querySelector('#right-title-group').style.display = 'none';
                    document.querySelector('#left-di-list').style.display = 'none';
                    document.querySelector('#right-di-list').style.display = 'none';
                } else {
                    document.querySelector('#right-title-group').style.display = 'block';
                    document.querySelector('#left-di-list').style.display = 'block';
                    document.querySelector('#right-di-list').style.display = 'block';
                }
                var mule, litem_node, name_node, count_node, name, count;
                for (var i = 0; i < MULES.size; i++) {
                    mule = MULES.getItem(i);
                    litem_node = document.createElement('div');
                    name_node = document.createElement('div');
                    count_node = document.createElement('div');
                    litem_node.id = 'mule-list-item';
                    name_node.id = 'mule-list-item-name';
                    count_node.id = 'mule-list-item-count';
                    litem_node.classList.add('mule-list-item');
                    name_node.classList.add('mule-list-item-name');
                    count_node.classList.add('mule-list-item-count');
                    name_node.innerText = mule.name;
                    count_node.innerText = mule.slots_filled + ' items';
                    litem_node.appendChild(name_node);
                    litem_node.appendChild(count_node);
                    if (i === 0) {
                        litem_node.classList.add('selected');
                        document.getElementById('right-heavy-title').innerText = mule.name;
                        document.getElementById('right-light-title').innerHTML = '&ndash; ' + Number(mule.slots_total-mule.slots_filled) + ' slots available';
                        document.getElementById('di-list-item-input-email').value = mule.email;
                        document.getElementById('di-list-item-input-password').value = mule.password;
                        document.getElementById('di-list-item-input-total').value = mule.slots_total;
                        document.getElementById('di-list-item-output-used').value = mule.slots_filled;
                    }
                    document.getElementById('mule-list').appendChild(litem_node);
                }
            }());
            
            // Renew responders
            (function () {
                function muleListItemButtonCallback() {
                    var items = Array.prototype.slice.call(document.getElementById('mule-list').children);
                    if (event.target.id === 'mule-list-item-name') {
                        document.getElementsByClassName('selected')[0].classList.remove('selected');
                        var item = event.target.parentNode;
                        var index = items.indexOf(event.target.parentNode);
                        event.target.parentNode.classList.add('selected');
                    } else if (event.target.id === 'mule-list-item') {
                        document.getElementsByClassName('selected')[0].classList.remove('selected');
                        var item = event.target;
                        var index = items.indexOf(event.target);
                        event.target.classList.add('selected');
                    } else {
                        return;
                    }
                    MULES.setProp(MULES, 'flag', index);
                    var mule = new PropertyStore();
                    mule.importItem(mule, MULES.getItem(index));
                    document.getElementById('right-heavy-title').innerText = mule.name;
                    document.getElementById('right-light-title').innerHTML = '&ndash; ' + Number(mule.slots_total-mule.slots_filled) + ' slots available';
                    document.getElementById('di-list-item-input-email').value = mule.email;
                    document.getElementById('di-list-item-input-password').value = mule.password;
                    document.getElementById('di-list-item-input-total').value = mule.slots_total;
                    document.getElementById('di-list-item-output-used').innerText = mule.slots_filled;
                }
                muleListItemButtonResponders = new InputResponders(document.getElementsByClassName('mule-list-item'));
                muleListItemButtonResponders.setCatalyst('click');
                muleListItemButtonResponders.setCallback(muleListItemButtonCallback);
                muleListItemButtonResponders.activate();
            }());
        }
        
        // AUTO-CALL FOR TESTING ONLY:
        DOMInjectMuleList();

    </script> <!-- global functions -->
    <script type="text/javascript">

        /* Load Preparation */
        (function () {

            // ... e.g. muleStore.sortBy('name'); & appendUIMules();

        }());

        /* Input Responders */
        (function () {

            // Input Response Instancializers    
            var createMuleButtonResponder = new InputResponder(document.getElementById('create-mule-button')); // (1)
            var renameMuleButtonResponder = new InputResponder(document.getElementById('rename-mule-button')); // (2)
            var deleteMuleButtonResponder = new InputResponder(document.getElementById('delete-mule-button')); // (3)
            var muleEmailChangeResponder = new InputResponder(document.getElementById('di-list-item-input-email')); // (4)
            var mulePcodeChangeResponder = new InputResponder(document.getElementById('di-list-item-input-password')); // (5)
            var muleSlotsChangeResponder = new InputResponder(document.getElementById('di-list-item-input-total')); // (6)
            var listCopyButtonAResponder = new InputResponder(document.querySelector('#di-list-item-action-button.email')); // (7)
            var listCopyButtonBResponder = new InputResponder(document.querySelector('#di-list-item-action-button.password')); // (8)

            // Input Response Callback Methods
            function createMuleButtonCallback() {
                
                var mule, litem_node, name_node, count_node, name, count;
                litem_node = document.createElement('div');
                name_node = document.createElement('input');
                count_node = document.createElement('div');
                litem_node.id = 'mule-list-item';
                name_node.id = 'mule-list-item-name';
                count_node.id = 'mule-list-item-count';
                litem_node.classList.add('mule-list-item');
                name_node.classList.add('mule-list-item-name');
                count_node.classList.add('mule-list-item-count');
                name_node.value = 'Mule Name';
                litem_node.appendChild(name_node);
                litem_node.appendChild(count_node);
                document.getElementById('mule-list').appendChild(litem_node);
                name_node.focus();
                name_node.select();
                function completeMuleAddition() {
                    var oldInput = document.querySelector('input#mule-list-item-name');
                    var muleName = oldInput.value;
                    var newDiv = document.createElement('div');
                    newDiv.id = 'mule-list-item-name';
                    newDiv.classList.add('mule-list-item-name');
                    newDiv.innerText = muleName;
                    oldInput.parentNode.insertBefore(newDiv, oldInput.firstChild);
                    oldInput.parentNode.removeChild(oldInput);
                    var mule3 = new PropertyStore(muleName);
                    mule3.setProp(mule3, 'slots_filled', 0);
                    mule3.setProp(mule3, 'slots_total', 16);
                    mule3.setProp(mule3, 'email', '');
                    mule3.setProp(mule3, 'password', '');
                    mule3.setProp(mule3, 'blocks', {});
                    MULES.addItem(mule3);
                    MULES.save();
                    DOMInjectMuleList();
                }
                document.querySelector('input#mule-list-item-name').addEventListener('blur', completeMuleAddition, false);
                document.querySelector('input#mule-list-item-name').addEventListener('keydown', function (event) {
                    if (event.keyCode === 13) {
                        document.querySelector('input#mule-list-item-name').blur();
                    } else if (event.keyCode === 9) {
                        // tab
                    } else {
                        return;
                    }
                });
                
                // Activate blur listener
                // Activate 'enter' listener
                // Activate 'tab' listener
                
                // THIS IS BY NO MEANS FINISHED; ONLY BEGUN

            } // (1)
            function renameMuleButtonCallback() {

                // Possibly remove this in favor of autosave
                // Get the current 'muleStore' variable (or whatever is used for unsynced changes)
                // And save it with the current data from current right and left window panes.

            } // (2) UNCODED
            function deleteMuleButtonCallback() {

                // Get the index of the current mule from the .selected in sidebar
                // Make sure user is sure! Remove that index from the unsynced 'muleStore' variable
                // Remove the content from the active right-window fields; remove entry from left-window
                // Sync with localStorage
                
                var items = Array.prototype.slice.call(document.getElementById('mule-list').children);
                var item = document.querySelector('.selected');
                var index = items.indexOf(item);
                if (item.previousElementSibling) {
                    item.previousElementSibling.classList.add('selected');
                } else if (item.nextElementSibling) {
                    item.nextElementSibling.classList.add('selected');
                } else {
                    // ...
                }
                item.classList.remove('selected');
                item.parentNode.removeChild(item);
                MULES.delItem(index);
                DOMInjectMuleList();
                
            } // (3)
            function muleEmailChangeCallback() {
                
                var items = Array.prototype.slice.call(document.getElementById('mule-list').children);
                var item = document.querySelector('.selected');
                var index = items.indexOf(item);
                var mule = new PropertyStore();
                mule.importItem(mule, MULES.getItem(index));
                var value = document.getElementById('di-list-item-input-email').value;
                mule.setProp(mule, 'email', value);
                MULES.setItem(index, mule);
                MULES.save();
                document.getElementById('di-list-item-input-email').blur();
                
            } // (4)
            function mulePcodeChangeCallback() {
                
                var items = Array.prototype.slice.call(document.getElementById('mule-list').children);
                var item = document.querySelector('.selected');
                var index = items.indexOf(item);
                var mule = new PropertyStore();
                mule.importItem(mule, MULES.getItem(index));
                var value = document.getElementById('di-list-item-input-password').value;
                mule.setProp(mule, 'password', value);
                MULES.setItem(index, mule);
                MULES.save();
                document.getElementById('di-list-item-input-password').blur();
                
            } // (5)
            function muleSlotsChangeCallback() {
                
                var items = Array.prototype.slice.call(document.getElementById('mule-list').children);
                var item = document.querySelector('.selected');
                var index = items.indexOf(item);
                var mule = new PropertyStore();
                mule.importItem(mule, MULES.getItem(index));
                var value = document.getElementById('di-list-item-input-total').value;
                mule.setProp(mule, 'slots_total', value);
                MULES.setItem(index, mule);
                MULES.save();
                document.getElementById('di-list-item-input-total').blur();
                document.getElementById('right-light-title').innerHTML = '&ndash; ' + Number(mule.slots_total-mule.slots_filled) + ' slots available';
                
            } // (6)
            function listCopyButtonACallback() {
                document.addEventListener('keydown', function(e) {
                    console.log(e.keyCode);
                }, false);
                document.querySelector('#di-list-item-input-email').focus();
                document.querySelector('#di-list-item-input-email').select();
            } // (7)
            function listCopyButtonBCallback() {
                document.querySelector('#di-list-item-input-password').focus();
                document.querySelector('#di-list-item-input-password').select();
            } // (8)

            // Input Response Catalysts
            createMuleButtonResponder.setCatalyst('click'); // (1)
            renameMuleButtonResponder.setCatalyst('click'); // (2)
            deleteMuleButtonResponder.setCatalyst('click'); // (3)
            muleEmailChangeResponder.setCatalyst('change'); // (4)
            mulePcodeChangeResponder.setCatalyst('change'); // (5)
            muleSlotsChangeResponder.setCatalyst('change'); // (6)
            listCopyButtonAResponder.setCatalyst('click'); // (7)
            listCopyButtonBResponder.setCatalyst('click'); // (8)

            // Input Response Callback Assigners
            createMuleButtonResponder.setCallback(createMuleButtonCallback); // (1)
            renameMuleButtonResponder.setCallback(renameMuleButtonCallback); // (2)
            deleteMuleButtonResponder.setCallback(deleteMuleButtonCallback); // (3)
            muleEmailChangeResponder.setCallback(muleEmailChangeCallback); // (4)
            mulePcodeChangeResponder.setCallback(mulePcodeChangeCallback); // (5)
            muleSlotsChangeResponder.setCallback(muleSlotsChangeCallback); // (6)
            listCopyButtonAResponder.setCallback(listCopyButtonACallback); // (7)
            listCopyButtonBResponder.setCallback(listCopyButtonBCallback); // (8)

            // Input Response Activators
            createMuleButtonResponder.activate(); // (1)
            renameMuleButtonResponder.activate(); // (2)
            deleteMuleButtonResponder.activate(); // (3)
            muleEmailChangeResponder.activate(); // (4)
            mulePcodeChangeResponder.activate(); // (5)
            muleSlotsChangeResponder.activate(); // (6)
            listCopyButtonAResponder.activate(); // (7)
            listCopyButtonBResponder.activate(); // (8)

        }());

    </script> <!-- applicate engine -->
    
      <!-- Block Standard Template

        <div class="pixel x0y0"></div>
        <div class="pixel x1y0"></div>
        <div class="pixel x2y0"></div>
        <div class="pixel x3y0"></div>
        <div class="pixel x4y0"></div>
        <div class="pixel x5y0"></div>
        <div class="pixel x6y0"></div>
        <div class="pixel x7y0"></div>

        <div class="pixel x0y1"></div>
        <div class="pixel x1y1"></div>
        <div class="pixel x2y1"></div>
        <div class="pixel x3y1"></div>
        <div class="pixel x4y1"></div>
        <div class="pixel x5y1"></div>
        <div class="pixel x6y1"></div>
        <div class="pixel x7y1"></div>

        <div class="pixel x0y2"></div>
        <div class="pixel x1y2"></div>
        <div class="pixel x2y2"></div>
        <div class="pixel x3y2"></div>
        <div class="pixel x4y2"></div>
        <div class="pixel x5y2"></div>
        <div class="pixel x6y2"></div>
        <div class="pixel x7y2"></div>

        <div class="pixel x0y3"></div>
        <div class="pixel x1y3"></div>
        <div class="pixel x2y3"></div>
        <div class="pixel x3y3"></div>
        <div class="pixel x4y3"></div>
        <div class="pixel x5y3"></div>
        <div class="pixel x6y3"></div>
        <div class="pixel x7y3"></div>

        <div class="pixel x0y4"></div>
        <div class="pixel x1y4"></div>
        <div class="pixel x2y4"></div>
        <div class="pixel x3y4"></div>
        <div class="pixel x4y4"></div>
        <div class="pixel x5y4"></div>
        <div class="pixel x6y4"></div>
        <div class="pixel x7y4"></div>

        <div class="pixel x0y5"></div>
        <div class="pixel x1y5"></div>
        <div class="pixel x2y5"></div>
        <div class="pixel x3y5"></div>
        <div class="pixel x4y5"></div>
        <div class="pixel x5y5"></div>
        <div class="pixel x6y5"></div>
        <div class="pixel x7y5"></div>

        <div class="pixel x0y6"></div>
        <div class="pixel x1y6"></div>
        <div class="pixel x2y6"></div>
        <div class="pixel x3y6"></div>
        <div class="pixel x4y6"></div>
        <div class="pixel x5y6"></div>
        <div class="pixel x6y6"></div>
        <div class="pixel x7y6"></div>

        <div class="pixel x0y7"></div>
        <div class="pixel x1y7"></div>
        <div class="pixel x2y7"></div>
        <div class="pixel x3y7"></div>
        <div class="pixel x4y7"></div>
        <div class="pixel x5y7"></div>
        <div class="pixel x6y7"></div>
        <div class="pixel x7y7"></div>

      End Block Standard Template -->
    
</body>
</html>